---
description: Automated git commit workflow with conventional commits
globs: 
alwaysApply: true
---
# Automated Commit Workflow Rules for YouTube VJ React Project

## Overview

This rule set defines an automated commit workflow that triggers when users indicate their intention to commit. The workflow includes staging verification, diff analysis, commit message generation, and commit execution.

## Workflow Triggers

### User Intent Keywords
When users express commit intention using these phrases, the automated workflow should activate:

**Japanese Triggers:**
- "ã‚³ãƒŸãƒƒãƒˆ"
- "ã‚³ãƒŸãƒƒãƒˆã—ã¦"
- "ã‚³ãƒŸãƒƒãƒˆã—ãŸã„"
- "ã‚³ãƒŸãƒƒãƒˆãŠé¡˜ã„ã—ã¾ã™"
- "å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ"
- "ã“ã‚Œã‚’ã‚³ãƒŸãƒƒãƒˆ"

**English Triggers:**
- "commit"
- "commit this"
- "commit changes"
- "make a commit"
- "please commit"
- "commit these changes"

## Automated Workflow Steps

### Step 1: Pre-Commit Validation
1. **Check git repository status**
   ```bash
   git status
   ```

2. **Verify staged changes exist**
   - If no changes staged: Ask user to specify files to stage
   - If changes staged: Proceed to Step 2

### Step 2: Staging Management
1. **NEVER auto-stage files (é‡è¦ãªãƒ«ãƒ¼ãƒ«)**
   - âŒ `git add .` ã‚„ `git add <file>` ã‚’è‡ªå‹•å®Ÿè¡Œã—ã¦ã¯ãªã‚‰ãªã„
   - âœ… æ—¢ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‡¦ç†ã™ã‚‹
   - âœ… ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ‰‹å‹•ã§ã®ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚’ä¿ƒã™

2. **Handle unstaged changes**
   - If no staged changes: Display message asking user to stage files first
   - Example message: "ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã—ã¦ãã ã•ã„: `git add <filename>`"
   - Only proceed if staged changes exist

### Step 3: Diff Analysis (CRITICAL - MANDATORY VALIDATION)

**ğŸš¨ ABSOLUTE REQUIREMENT: MUST EXECUTE `git diff --cached` BEFORE ANY COMMIT OPERATION**

1. **Mandatory Diff Verification (çµ¶å¯¾å¿…é ˆ)**
   ```bash
   git status        # First: Check overall repository state
   git diff --cached | cat  # Second: MUST review staged changes
   ```

2. **Critical Pre-Commit Validation Checklist**
   - âœ… **MUST execute `git diff --cached` and analyze output**
   - âœ… **MUST verify that commit message matches ONLY staged files**
   - âœ… **MUST NOT include unstaged files in commit message**
   - âœ… **MUST respect user's intentional staging decisions**
   - âœ… **MUST generate commit message based ONLY on staged diff content**

3. **Staging Verification Rules**
   - **Never assume**: Always verify what is actually staged
   - **User Intent**: Respect user's explicit staging choices
   - **Accuracy**: Commit message must reflect ONLY staged changes
   - **Verification**: If unsure, ask user to confirm staging intent

4. **Diff Analysis Process**
   - **Complete diff retrieval**: Full `git diff --cached` output
   - **File-by-file analysis**: Review each staged file change
   - **Change type identification**: Categorize modifications appropriately
   - **Message alignment**: Ensure commit message describes actual staged changes

5. **Error Prevention**
   - **Mismatch Detection**: Flag if commit message doesn't match staged content
   - **Missing Files**: Never reference unstaged files in commit message
   - **User Communication**: Clearly explain what will be committed

6. **Handle new files**
   - For new files: Read file content directly
   - Explain that file content equals diff for new files

**VIOLATION CONSEQUENCES**: 
- If this step is skipped or executed incorrectly, it results in:
  - âŒ Inaccurate commit messages
  - âŒ Unintended file inclusion/exclusion
  - âŒ Loss of user trust and workflow integrity
  - âŒ Violation of explicit user staging decisions

### Step 4: Commit Message Generation
1. **Analyze diff content**
   - Identify change types (feat, fix, docs, style, refactor, etc.)
   - Determine scope if applicable
   - Extract key changes for description

2. **Generate Conventional Commit message**
   ```
   <type>[optional scope]: <description>
   
   [optional body]
   
   [optional footer(s)]
   ```

3. **Validate message format**
   - **Ensure English language ONLY** - Never use Japanese or other languages
   - Verify Conventional Commits compliance
   - Check description clarity

### Step 5: Commit Execution
1. **Present commit message to user**
   ```
   Generated commit message:
   [commit message]
   
   Execute commit? (Auto-executing...)
   ```

2. **Execute commit**
   ```bash
   git commit -m "[generated message]"
   ```

## Error Handling

### Diff Retrieval Issues
1. **Complete failure**: Request manual diff input
2. **New files**: Read file content directly with explanation

### Commit Failures
1. **Pre-commit hook failures**: Show lint errors and stop
2. **Merge conflicts**: Instruct user to resolve conflicts
3. **No changes**: Inform user and abort

## Safety Measures

### Critical Workflow Execution Policy (æœ€é‡è¦ãƒãƒªã‚·ãƒ¼)
**ğŸš¨ ZERO TOLERANCE FOR WORKFLOW VIOLATIONS**

1. **Mandatory Verification Sequence**
   ```bash
   # MUST ALWAYS execute in this exact order:
   git status                    # 1. Check repository state
   git diff --cached | cat       # 2. Review staged changes
   # 3. Generate commit message based ONLY on staged diff
   # 4. Execute commit
   ```

2. **Forbidden Actions**
   - âŒ **NEVER commit without `git diff --cached` verification**
   - âŒ **NEVER generate commit messages without reviewing actual staged changes**
   - âŒ **NEVER assume what files are staged**
   - âŒ **NEVER include unstaged files in commit descriptions**
   - âŒ **NEVER override user's intentional staging decisions**

3. **Required Verification Points**
   - âœ… Staged files list matches commit message content
   - âœ… Unstaged files are explicitly excluded from commit message
   - âœ… User's staging intent is respected and preserved
   - âœ… Commit message accurately reflects actual changes being committed

### Staging Policy (æœ€é‡è¦ãƒ«ãƒ¼ãƒ«)
- **çµ¶å¯¾ã« `git add` ã‚’è‡ªå‹•å®Ÿè¡Œã—ãªã„**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‡¦ç†
- ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å ´åˆã¯é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¿ƒã™
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã‚ˆã†å®‰å…¨ã‚’ç¢ºä¿

### User Confirmation
- Always show generated commit message before execution
- Present commit message for user review before execution
- Allow manual message editing if requested

### Rollback Capability
- Provide instructions for `git reset --soft HEAD^` if needed

### Diff Verification Accountability
- **Every commit operation MUST be preceded by diff verification**
- **Commit messages MUST be generated from actual staged content**
- **No exceptions**: This rule applies to ALL commit operations
- **Accountability**: Any violation of this policy is a critical workflow failure

## Commit Message Standards

### Types
- **feat**: New feature
- **fix**: Bug fix
- **docs**: Documentation changes
- **style**: Code formatting
- **refactor**: Code restructuring
- **perf**: Performance improvements
- **test**: Testing additions/fixes
- **chore**: Build/tool changes
- **ci**: CI configuration and scripts
- **build**: Build system and external dependencies

### Format Requirements
- **English language only (è‹±èªã®ã¿)** - CRITICAL REQUIREMENT
  - All commit messages MUST be written in English
  - This ensures consistency and international compatibility
  - Even when user communicates in Japanese, commit messages are always English
  - Examples: "feat: add new feature" âœ…, "feat: æ–°æ©Ÿèƒ½ã‚’è¿½åŠ " âŒ
- Clear, concise descriptions
- Proper conventional commits structure
- Informative body for complex changes

## Workflow Customization

### Skip Confirmation Mode
If user adds "ã™ãã«" or "immediately":
- Skip confirmation prompt
- Execute commit immediately after message generation

### Manual Message Mode
If user requests custom message:
- Generate suggested message
- Ask for user's preferred message
- Use user's message instead

## Example Workflows

### Successful Workflow
```
User: "ã‚³ãƒŸãƒƒãƒˆã—ã¦"
â†’ Check git status
â†’ Verify staged changes exist
â†’ Analyze diff with git diff --cached
â†’ Generate: "feat: add new YouTube player controls"
â†’ Execute commit
```

### No Staging Available Workflow
```
User: "ã‚³ãƒŸãƒƒãƒˆã—ã¦"
â†’ Check git status
â†’ No staged changes found
â†’ Response: "ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã—ã¦ãã ã•ã„: `git add <filename>`"
â†’ Do NOT execute git add automatically
```

### Lint Error Workflow
```
User: "ã‚³ãƒŸãƒƒãƒˆã—ãŸã„"
â†’ Pre-commit hook fails
â†’ Show lint errors
â†’ Response: "Please fix lint errors before committing"
```

### Critical Verification Workflow (NEW)
```
User: "ã‚³ãƒŸãƒƒãƒˆ"
â†’ git status (check repository state)
â†’ git diff --cached | cat (MANDATORY - review staged changes)
â†’ Verify commit message matches ONLY staged files
â†’ Generate accurate commit message
â†’ Execute commit
```

This automated workflow ensures consistent, high-quality commits while maintaining strict verification standards and respecting user intent. 